# OSI Layers
네트워크 통신을 추상화해서 여러 layer들로 나누어놓은 모델입니다.  
여기서 아랫쪽 layer들은 위에서 뭐가 돌고 있는지 신경을 쓰지 않고, 위의 layer들은 아래에서 어떻게 통신이 이루어지고 있는지에 상관없이 동작합니다(유/무선/LTE 중 어떤걸로 연결되어있어도 TCP/IP, HTTP같은 프로토콜은 바뀌지 않습니다).  
하지만, OSI layer는 오직 모델일 뿐이고, 실제로 사용되는 프로토콜은 여러 layer들을 모두 다 관리하거나 할 수도 있습니다.  

## 1. Physical Layer:
두 기기 간 통신을 하는 매체(medium). 유선이면 전자 신호, 무선이면 라디오 신호 등.

## 2. Data Link Layer:
MAC 주소, 802.11(WiFi), 802.3(Ethernet) 등이 layer 2입니다. 
주로 직접 연결되있는 두 기기 간 통신(`노트북 <-> 공유기`)은 이걸 사용한다고 보면 됩니다.  
여기서 네트워크 스위치는 두 네트워크가 직접 연결되어있는것처럼 보이게 할 수 있습니다. 예를 들어,

```
+---+                              +---+
| A |-------+              +-------| C |
+---+       |              |       +---+
      +----------+   +----------+
      | Switch 1 |---| Switch 2 |
      +----------+   +----------+
+---+       |              |       +---+
| B |-------+              + ------| D |
+---+                              +---+
```

이런 식으로 연결이 되어있다면 `A` 와 `D` 는 서로 똑같은 네트워크에 있는 것처럼 보이고, 서로의 MAC주소를 사용해서 통신을 할 수 있습니다. 이 layer에선 아직 IP 주소의 개념이 존재하지 않습니다.

## 3. Network Layer:
IP 주소 layer입니다. 각 기기마다 고유의 [IP 주소](ip_address.md)를 받고, 다른 기기와 통신을 할 때 IP 주소를 사용해서 통신을 할 상대를 지정합니다.  
만약 위에 있는 그림에서 `A (192.168.0.2)` 와 `B (192.168.0.17)`가 통신을 하고 싶은데 서로의 MAC 주소는 모르지만 IP 주소를 알고 있다면, 각자 Address Resolution Protocol(ARP)을 사용해서 "192.168.0.17 의 MAC 주소를 알면 대답해줘!" -> "192.168.0.17은 12:34:56:78:aa:bb에 있어!" 식으로 서로의 MAC 주소를 알아낸 후 통신을 합니다 (여기서 ARP는 layer 2 와 layer 3 둘 다 포괄하는 프로토콜입니다).  

만약 같은 네트워크에 없는 기기와 통신을 하려면 (내 주소가 `192.168.0.2/24`이면, `192.168.0.*` 에 포함되지 않는 주소는 내 기기가 직접 통신을 할 수 없는 기기입니다.) default gateway 로 설정된 라우터로 일단 패킷을 보낸 후, 이 라우터는 (주로 ISP에서 운영하는) 다른 라우터로 이 패킷을 포워드를 여러번 하고 나서 도착지에 도착하는 식으로 작동합니다.

```
+--------------------+   +--------+   +------------+   +-----+
| A (192.168.0.2/24) |---| router |---| ISP router |---| ... |
+--------------------+   +--------+   +------------+   +-----+
                                                          |
                                           +-----------------------------+
                                           | github.com (192.30.255.112) |
                                           +-----------------------------+
```

## 4. Transport Layer:
TCP/UDP 는 layer 4입니다. Transport layer에서는 포트번호가 추가되고, TCP의 경우에는 안정성이 보장됩니다. 포트 번호는 하나의 컴퓨터에서 여러 서비스를 동시에 접속할 수 있게 하는 것으로, TCP / UDP 와 포트 번호에는 아무런 연관성이 없습니다.  
만약 포트 번호가 없다면, A (`192.168.0.2`) 와 D (`192.168.0.17`)이 서로 연결을 2개를 동시에 맺으려고 할 때, A는 "`192.168.0.17`와의 연결"이라는 것 외에 이 두 연결을 구별할 수 있는 방법이 없습니다. 
포트 번호를 사용하면 "`192.168.0.17:5582`와의 연결"이랑 "`192.168.0.17:52307`와의 연결"을 구별할 수 있습니다. 주로 layer 4부터 연결은 source address, source port, destination address, destination port, 이 4개의 tuple로써 식별됩니다.  

UDP는 User Datagram Protocol의 약자로, 단순히 패킷을 보내기만 하고 답장을 기다리지 않는 프로토콜입니다. 주로 VoIP나 스트리밍같이 가끔식 패킷을 잃어버리더라도 무조건 빠르게 보내는게 중요할 때 사용합니다.  
TCP는 Transport Control Protocol의 약자로, UDP와 다르게 모든 패킷을 보낸 후 답장이 올 때까지 기다립니다(이 과정을 3-way handshake라고 부릅니다). 그림으로 보자면,

```
     A      |     B
    (3-way handshake)
    SYN     |
            |  SYN-ACK
    ACK     |
(from here on, connection is ESTABLISHED)
SYN (data1) |
            |    ACK
SYN (data2) |
            |    ACK
SYN (data3) |
            | (silence)
SYN (data3) |
            |    ACK
 (closing connection...)
    FIN     |
            |    ACK
            |    FIN
    ACK     |
   (connection CLOSED)
```

이런 식으로 모든 패킷이 잘 도달했는지 확인을 하고 또 받는 쪽에서는 패킷의 순서가 바뀌진 않았는지, 중간에 누락된 패킷은 없는지 확인이 가능한 프로토콜입니다. 
TCP는 안정성을 보장해주는 대신 UDP보다 느릴 수 있습니다.

## 5. Session Layer:
두 기기 사이의 session, 또는 state를 관리합니다. TCP를 사용한다면 TCP에서 직접 관리하고, UDP의 경우 아예 없거나 그 위의 application이 처리하는 경우도 있습니다.

## 6. Presentation Layer:
Application 사이에 통신할 때 사용할 인코딩 등을 말합니다. 
또는, TLS같은 암호화 layer도 presentation에 속한다고 할 수 있습니다.  
특히 TLS의 경우 네트워크를 통해서 보내는 정보는 외부 공격자가 읽을 수 없도록 암호화를 하지만, 받는 쪽에서 TLS 암호화를 푼 다음 그 위에 있는 application layer에게 넘겨주고 나면 application layer에서는 그 어떤 차이도 없습니다. 
즉, application layer에서는 네트워크로 어떤 정보를 보낼 때 암호화 여부에 관계 없이 아무런 차이가 없다는 것입니다.

## 7. Application Layer:
실제로 우리가 보내거나 받고 싶었던 정보. [HTTP](https.md)나 [DNS](dns.md)같은 프로토콜이 바로 application layer에 있습니다.
